<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TekVelo - Custom Bicycle Builder</title>
    
    <!-- 1. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 1.5. CONFIGURE TAILWIND FOR DARK MODE -->
    <script>
      tailwind.config = {
        darkMode: 'class', // This tells Tailwind to use the 'dark' class on the <html> tag
        theme: {
          extend: {},
        },
        plugins: [],
      }
    </script>
    
    <!-- 2. Load React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- 3. Load Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      /* Simple scrollbar for dark mode in Chrome/Safari */
      html.dark ::-webkit-scrollbar {
        width: 12px;
        height: 12px;
      }
      html.dark ::-webkit-scrollbar-track {
        background: #1a202c; /* dark:bg-gray-800 */
      }
      html.dark ::-webkit-scrollbar-thumb {
        background-color: #4a5568; /* dark:bg-gray-600 */
        border-radius: 6px;
        border: 3px solid #1a202c; /* dark:bg-gray-800 */
      }
      html.dark ::-webkit-scrollbar-thumb:hover {
        background-color: #718096; /* dark:bg-gray-500 */
      }
      /* Simple scrollbar for Firefox */
      html.dark {
        scrollbar-color: #4a5568 #1a202c;
        scrollbar-width: thin;
      }
      /* CSS for printing */
      @media print {
        /* Hide everything except the modal content */
        body > *:not(.print-modal-container) {
          display: none;
        }
        /* Ensure the modal content is visible */
        .print-modal-container {
          display: block !important;
          position: absolute;
          left: 0;
          top: 0;
          width: 100%;
        }
        /* Style the modal for printing */
        #summary-to-print {
          display: block !important;
          box-shadow: none !important;
          border: none !important;
          color: #000 !important;
        }
        /* Hide all text colors */
        .print-modal-container * {
          color: #000 !important;
          background: #fff !important;
          background-image: none !important;
          text-shadow: none !important;
          box-shadow: none !important;
          /* text-fill-color: unset !important; */
          -webkit-text-fill-color: unset !important;
        }
        /* Re-style key elements for print */
        #summary-to-print h4, #summary-to-print h5 {
          font-size: 1.5rem;
          margin-bottom: 1rem;
        }
        #summary-to-print p, #summary-to-print li {
          font-size: 1rem;
        }
      }
      
      /* Custom Toggle Switch Style */
      .toggle-checkbox:checked {
        background-color: #2563eb;
        right: 0;
        border-color: #2563eb; /* blue-600 */
      }
      .toggle-checkbox:checked + .toggle-label {
        background-color: #2563eb;
      }
      .toggle-checkbox:checked + .toggle-label::after {
        transform: translateX(1.25rem); /* 20px */
      }
    </style>
  </head>
  <body class="bg-gray-100">
    
    <!-- 4. This is where your React app will be mounted -->
    <div id="root"></div>

    <!-- 
      5. Load your React app file. 
      The 'src' attribute has been removed, and the React code
      is now placed *inside* this script tag.
    -->
    <script type="text/babel">
      // --- START OF INLINED REACT APP ---

      // --- DATA ---
      const partLists = {
        // --- UPDATED MODEL NAME ---
        'Signature 26" steel basic"': [
          // This list is now dynamically generated, but we keep the key
        ],
        'Ares 26" 21s d/d': [
          'Frame', 'Suspension Fork', 'Fork fitting', 'Handle stem', 'Handle bar', 'Hub-direct mount', 'Spokes', 'Rim', 'Rim tape', 'Tube', 'Tyre', 'Bb axil', 'Stand', 'Crankset', 'Chain', 'Freewheel', 'Front derailleur', 'Rear derailleur', 'Pedal', 'Shifter', 'Grip', 'Brake', 'Cable front', 'Cable rear', 'Disc plate', 'Disc machine', 'Seat pillar', 'Seat clamp', 'Seat Reflector'
        ],
        'Spear 26" 21s d/d': [
          'Frame', 'Suspension Fork', 'Fork fitting', 'Handle stem', 'Handle bar', 'Hub-direct mount', 'Spokes', 'Rim', 'Rim tape', 'Tube', 'Tyre', 'Bb axil', 'Stand', 'Crankset', 'Chain', 'Freewheel', 'Front derailleur', 'Rear derailleur', 'Pedal', 'Shifter', 'Grip', 'Brake', 'Cable front', 'Cable rear', 'Disc plate', 'Disc machine', 'Seat pillar', 'Seat clamp', 'Seat Reflector'
        ]
      };

      const getImg = (part) => `https://placehold.co/100x100/e0e0e0/333?text=${part.substring(0, 3)}`;

      // --- OLD DATA FOR ARES/SPEAR ---
      const partDetails = {
        'Frame': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 150, image: getImg('Frame') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 202, image: getImg('Frame') },
          { vendor: 'ProFrame', quality: 'Pro', price: 255, image: getImg('Frame') },
          { vendor: 'AeroTech', quality: 'Premium', price: 307, image: getImg('Frame') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 360, image: getImg('Frame') }
        ],
        'Fork': [
          { vendor: 'SteelFork', quality: 'Standard', price: 80, image: getImg('Fork') },
          { vendor: 'AlloyFork', quality: 'Enhanced', price: 110, image: getImg('Fork') },
          { vendor: 'CarbonFork', quality: 'Pro', price: 150, image: getImg('Fork') },
          { vendor: 'ProGrade', quality: 'Premium', price: 180, image: getImg('Fork') },
          { vendor: 'Featherweight', quality: 'Ultralight', price: 210, image: getImg('Fork') }
        ],
        'Fork fitting': [
          { vendor: 'BasicFit', quality: 'Standard', price: 15, image: getImg('Fit') },
          { vendor: 'SureFit', quality: 'Enhanced', price: 20, image: getImg('Fit') },
          { vendor: 'ProFit', quality: 'Pro', price: 25, image: getImg('Fit') },
          { vendor: 'LockFit', quality: 'Premium', price: 30, image: getImg('Fit') },
          { vendor: 'TitanFit', quality: 'Ultralight', price: 35, image: getImg('Fit') }
        ],
        'Handle stem': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 20, image: getImg('Stem') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 27, image: getImg('Stem') },
          { vendor: 'ProFrame', quality: 'Pro', price: 34, image: getImg('Stem') },
          { vendor: 'AeroTech', quality: 'Premium', price: 41, image: getImg('Stem') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 48, image: getImg('Stem') }
        ],
        'Handle bar': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 25, image: getImg('Bar') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 33, image: getImg('Bar') },
          { vendor: 'ProFrame', quality: 'Pro', price: 42, image: getImg('Bar') },
          { vendor: 'AeroTech', quality: 'Premium', price: 51, image: getImg('Bar') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 60, image: getImg('Bar') }
        ],
        'Hub': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 40, image: getImg('Hub') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 54, image: getImg('Hub') },
          { vendor: 'ProFrame', quality: 'Pro', price: 68, image: getImg('Hub') },
          { vendor: 'AeroTech', quality: 'Premium', price: 82, image: getImg('Hub') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 96, image: getImg('Hub') }
        ],
        'Spokes': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 15, image: getImg('Spk') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 20, image: getImg('Spk') },
          { vendor: 'ProFrame', quality: 'Pro', price: 25, image: getImg('Spk') },
          { vendor: 'AeroTech', quality: 'Premium', price: 30, image: getImg('Spk') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 36, image: getImg('Spk') }
        ],
        'Rim': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 35, image: getImg('Rim') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 47, image: getImg('Rim') },
          { vendor: 'ProFrame', quality: 'Pro', price: 59, image: getImg('Rim') },
          { vendor: 'AeroTech', quality: 'Premium', price: 71, image: getImg('Rim') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 84, image: getImg('Rim') }
        ],
        'Rim tape': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 5, image: getImg('Tap') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 6, image: getImg('Tap') },
          { vendor: 'ProFrame', quality: 'Pro', price: 8, image: getImg('Tap') },
          { vendor: 'AeroTech', quality: 'Premium', price: 10, image: getImg('Tap') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 12, image: getImg('Tap') }
        ],
        'Tube': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 7, image: getImg('Tub') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 9, image: getImg('Tub') },
          { vendor: 'ProFrame', quality: 'Pro', price: 11, image: getImg('Tub') },
          { vendor: 'AeroTech', quality: 'Premium', price: 14, image: getImg('Tub') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 16, image: getImg('Tub') }
        ],
        'Tyre': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 20, image: getImg('Tyr') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 27, image: getImg('Tyr') },
          { vendor: 'ProFrame', quality: 'Pro', price: 34, image: getImg('Tyr') },
          { vendor: 'AeroTech', quality: 'Premium', price: 41, image: getImg('Tyr') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 48, image: getImg('Tyr') }
        ],
        'Bb cup': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 10, image: getImg('Bbc') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 13, image: getImg('Bbc') },
          { vendor: 'ProFrame', quality: 'Pro', price: 17, image: getImg('Bbc') },
          { vendor: 'AeroTech', quality: 'Premium', price: 20, image: getImg('Bbc') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 24, image: getImg('Bbc') }
        ],
        'Bb axil': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 15, image: getImg('Bbx') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 20, image: getImg('Bbx') },
          { vendor: 'ProFrame', quality: 'Pro', price: 25, image: getImg('Bbx') },
          { vendor: 'AeroTech', quality: 'Premium', price: 30, image: getImg('Bbx') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 36, image: getImg('Bbx') }
        ],
        'Bb bearing': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 10, image: getImg('Bbb') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 13, image: getImg('Bbb') },
          { vendor: 'ProFrame', quality: 'Pro', price: 17, image: getImg('Bbb') },
          { vendor: 'AeroTech', quality: 'Premium', price: 20, image: getImg('Bbb') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 24, image: getImg('Bbb') }
        ],
        'Stand': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 12, image: getImg('Std') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 16, image: getImg('Std') },
          { vendor: 'ProFrame', quality: 'Pro', price: 20, image: getImg('Std') },
          { vendor: 'AeroTech', quality: 'Premium', price: 24, image: getImg('Std') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 28, image: getImg('Std') }
        ],
        'Crank': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 45, image: getImg('Crk') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 60, image: getImg('Crk') },
          { vendor: 'ProFrame', quality: 'Pro', price: 76, image: getImg('Crk') },
          { vendor: 'AeroTech', quality: 'Premium', price: 92, image: getImg('Crk') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 108, image: getImg('Crk') }
        ],
        'Chain': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 15, image: getImg('Chn') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 20, image: getImg('Chn') },
          { vendor: 'ProFrame', quality: 'Pro', price: 25, image: getImg('Chn') },
          { vendor: 'AeroTech', quality: 'Premium', price: 30, image: getImg('Chn') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 36, image: getImg('Chn') }
        ],
        'Freewheel': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 25, image: getImg('Frw') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 33, image: getImg('Frw') },
          { vendor: 'ProFrame', quality: 'Pro', price: 42, image: getImg('Frw') },
          { vendor: 'AeroTech', quality: 'Premium', price: 51, image: getImg('Frw') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 60, image: getImg('Frw') }
        ],
        'Pedal': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 18, image: getImg('Ped') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 24, image: getImg('Ped') },
          { vendor: 'ProFrame', quality: 'Pro', price: 30, image: getImg('Ped') },
          { vendor: 'AeroTech', quality: 'Premium', price: 36, image: getImg('Ped') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 43, image: getImg('Ped') }
        ],
        'Brake liver': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 10, image: getImg('Brl') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 13, image: getImg('Brl') },
          { vendor: 'ProFrame', quality: 'Pro', price: 17, image: getImg('Brl') },
          { vendor: 'AeroTech', quality: 'Premium', price: 20, image: getImg('Brl') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 24, image: getImg('Brl') }
        ],
        'Grip': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 8, image: getImg('Grp') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 10, image: getImg('Grp') },
          { vendor: 'ProFrame', quality: 'Pro', price: 13, image: getImg('Grp') },
          { vendor: 'AeroTech', quality: 'Premium', price: 16, image: getImg('Grp') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 19, image: getImg('Grp') }
        ],
        'Cable': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 5, image: getImg('Cbl') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 6, image: getImg('Cbl') },
          { vendor: 'ProFrame', quality: 'Pro', price: 8, image: getImg('Cbl') },
          { vendor: 'AeroTech', quality: 'Premium', price: 10, image: getImg('Cbl') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 12, image: getImg('Cbl') }
        ],
        'Power arch': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 15, image: getImg('Pwa') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 20, image: getImg('Pwa') },
          { vendor: 'ProFrame', quality: 'Pro', price: 25, image: getImg('Pwa') },
          { vendor: 'AeroTech', quality: 'Premium', price: 30, image: getImg('Pwa') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 36, image: getImg('Pwa') }
        ],
        'Seat pillar': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 20, image: getImg('Spp') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 27, image: getImg('Spp') },
          { vendor: 'ProFrame', quality: 'Pro', price: 34, image: getImg('Spp') },
          { vendor: 'AeroTech', quality: 'Premium', price: 41, image: getImg('Spp') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 48, image: getImg('Spp') }
        ],
        'Seat clamp': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 5, image: getImg('Clp') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 6, image: getImg('Clp') },
          { vendor: 'ProFrame', quality: 'Pro', price: 8, image: getImg('Clp') },
          { vendor: 'AeroTech', quality: 'Premium', price: 10, image: getImg('Clp') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 12, image: getImg('Clp') }
        ],
        'Seat Reflector': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 3, image: getImg('Ref') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 4, image: getImg('Ref') },
          { vendor: 'ProFrame', quality: 'Pro', price: 5, image: getImg('Ref') },
          { vendor: 'AeroTech', quality: 'Premium', price: 6, image: getImg('Ref') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 7, image: getImg('Ref') }
        ],
        'Suspension Fork': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 120, image: getImg('Sus') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 162, image: getImg('Sus') },
          { vendor: 'ProFrame', quality: 'Pro', price: 204, image: getImg('Sus') },
          { vendor: 'AeroTech', quality: 'Premium', price: 246, image: getImg('Sus') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 288, image: getImg('Sus') }
        ],
        'Hub-direct mount': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 45, image: getImg('Hub') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 60, image: getImg('Hub') },
          { vendor: 'ProFrame', quality: 'Pro', price: 76, image: getImg('Hub') },
          { vendor: 'AeroTech', quality: 'Premium', price: 92, image: getImg('Hub') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 108, image: getImg('Hub') }
        ],
        'Crankset': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 55, image: getImg('Crk') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 74, image: getImg('Crk') },
          { vendor: 'ProFrame', quality: 'Pro', price: 93, image: getImg('Crk') },
          { vendor: 'AeroTech', quality: 'Premium', price: 112, image: getImg('Crk') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 132, image: getImg('Crk') }
        ],
        'Front derailleur': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 22, image: getImg('Fdr') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 29, image: getImg('Fdr') },
          { vendor: 'ProFrame', quality: 'Pro', price: 37, image: getImg('Fdr') },
          { vendor: 'AeroTech', quality: 'Premium', price: 45, image: getImg('Fdr') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 52, image: getImg('Fdr') }
        ],
        'Rear derailleur': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 30, image: getImg('Rdr') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 40, image: getImg('Rdr') },
          { vendor: 'ProFrame', quality: 'Pro', price: 51, image: getImg('Rdr') },
          { vendor: 'AeroTech', quality: 'Premium', price: 61, image: getImg('Rdr') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 72, image: getImg('Rdr') }
        ],
        'Shifter': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 35, image: getImg('Shf') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 47, image: getImg('Shf') },
          { vendor: 'ProFrame', quality: 'Pro', price: 59, image: getImg('Shf') },
          { vendor: 'AeroTech', quality: 'Premium', price: 71, image: getImg('Shf') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 84, image: getImg('Shf') }
        ],
        'Brake': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 28, image: getImg('Brk') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 37, image: getImg('Brk') },
          { vendor: 'ProFrame', quality: 'Pro', price: 47, image: getImg('Brk') },
          { vendor: 'AeroTech', quality: 'Premium', price: 57, image: getImg('Brk') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 67, image: getImg('Brk') }
        ],
        'Cable front': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 6, image: getImg('Cbf') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 8, image: getImg('Cbf') },
          { vendor: 'ProFrame', quality: 'Pro', price: 10, image: getImg('Cbf') },
          { vendor: 'AeroTech', quality: 'Premium', price: 12, image: getImg('Cbf') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 14, image: getImg('Cbf') }
        ],
        'Cable rear': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 6, image: getImg('Cbr') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 8, image: getImg('Cbr') },
          { vendor: 'ProFrame', quality: 'Pro', price: 10, image: getImg('Cbr') },
          { vendor: 'AeroTech', quality: 'Premium', price: 12, image: getImg('Cbr') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 14, image: getImg('Cbr') }
        ],
        'Disc plate': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 15, image: getImg('Dsc') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 20, image: getImg('Dsc') },
          { vendor: 'ProFrame', quality: 'Pro', price: 25, image: getImg('Dsc') },
          { vendor: 'AeroTech', quality: 'Premium', price: 30, image: getImg('Dsc') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 36, image: getImg('Dsc') }
        ],
        'Disc machine': [
          { vendor: 'VeloBasic', quality: 'Standard', price: 25, image: getImg('Dsm') },
          { vendor: 'RideSolid', quality: 'Enhanced', price: 33, image: getImg('Dsm') },
          { vendor: 'ProFrame', quality: 'Pro', price: 42, image: getImg('Dsm') },
          { vendor: 'AeroTech', quality: 'Premium', price: 51, image: getImg('Dsm') },
          { vendor: 'CarbonLite', quality: 'Ultralight', price: 60, image: getImg('Dsm') }
        ],
      };

      // --- NEW DATA FOR "Signature 26" steel basic" ---
      // I've filled this with placeholder data and prices based on your list.
      // You can edit all names and prices here.
      const signatureModelData = {
        compulsory: [
          { id: 'frame', name: 'Frame - signature 26"', price: 900 },
          { id: 'fork', name: 'Fork - signature 26"', price: 200 }
        ],
        toggles: [
          { id: 'forkFitting', name: 'Fork fitting - set of 5', price: 75 },
          { id: 'freewheel', name: 'Freewheel - 18 teeth', price: 60 },
          { id: 'stand', name: 'Stand - dual bolt boot stand', price: 70 },
          { id: 'chain', name: 'Chain - bushless roller chain', price: 115 },
          { id: 'seatPillar', name: 'Seat pillar - 9"', price: 80 },
          { id: 'rimTape', name: 'Rim tape - plastic', price: 10 },
          { id: 'reflector', name: 'Reflector - common', price: 40 }
        ],
        singleSelect: [
          {
            id: 'tyre', name: 'Tyre - (26x2.1 recommended)',
            options: [
              { id: 'tyre_ralson', name: 'Ralson', price: 250 },
              { id: 'tyre_hartex', name: 'Hartex', price: 250 },
              { id: 'tyre_metro', name: 'Metro', price: 250 },
              { id: 'tyre_hindustan', name: 'Hindustan', price: 250 }
            ]
          },
          {
            id: 'tube', name: 'Tube',
            options: [
              { id: 'tube_ralson_motor', name: 'Ralson motor neck', price: 120 },
              { id: 'tube_ralson_valve', name: 'Ralson valve tube', price: 90 },
              { id: 'tube_bedrock_motor', name: 'Bedrock motor neck', price: 120 },
              { id: 'tube_bedrock_valve', name: 'Bedrock valve tube', price: 90 }
            ]
          },
          {
            id: 'pedal', name: 'Pedal',
            options: [
              { id: 'pedal_1', name: 'Basic Pedal', price: 90 },
              { id: 'pedal_2', name: 'Reflector Pedal', price: 100 },
              { id: 'pedal_3', name: 'Alloy Pedal', price: 120 },
              { id: 'pedal_4', name: 'Premium Pedal', price: 150 }
            ]
          },
          {
            id: 'grip', name: 'Grip',
            options: [
              { id: 'grip_1', name: 'Basic Grip', price: 40 },
              { id: 'grip_2', name: 'Comfort Grip', price: 50 },
              { id: 'grip_3', name: 'Ergo Grip', price: 60 },
              { id: 'grip_4', name: 'Lock-on Grip', price: 70 }
            ]
          },
          {
            id: 'seat', name: 'Seat',
            options: [
              { id: 'seat_1', name: 'Basic Saddle', price: 180 },
              { id: 'seat_2', name: 'Comfort Saddle', price: 210 },
              { id: 'seat_3', name: 'Sport Saddle', price: 240 },
              { id: 'seat_4', name: 'Gel Saddle', price: 270 }
            ]
          },
          {
            id: 'seatClamp', name: 'Seat Clamp',
            options: [
              { id: 'seatclamp_qr_1', name: 'Quick Release - Option 1', price: 50 },
              { id: 'seatclamp_qr_2', name: 'Quick Release - Option 2', price: 50 },
              { id: 'seatclamp_nb_1', name: 'Nut & Bolt - Option 1', price: 10 },
              { id: 'seatclamp_nb_2', name: 'Nut & Bolt - Option 2', price: 10 }
            ]
          },
          {
            id: 'powerArch', name: 'Power Arch',
            options: [
              { id: 'pa_1', name: 'Arch Type 1', price: 130 },
              { id: 'pa_2', name: 'Arch Type 2', price: 140 },
              { id: 'pa_3', name: 'Arch Type 3', price: 150 },
              { id: 'pa_4', name: 'Arch Type 4', price: 160 }
            ]
          },
          {
            id: 'cable', name: 'Cable',
            options: [
              { id: 'cable_1', name: 'Cable Set 1', price: 35 },
              { id: 'cable_2', name: 'Cable Set 2', price: 35 },
              { id: 'cable_3', name: 'Cable Set 3', price: 35 },
              { id: 'cable_4', name: 'Cable Set 4', price: 35 }
            ]
          },
          {
            id: 'breakLever', name: 'Break Lever',
            options: [
              { id: 'bl_1', name: 'Lever Type 1', price: 100 },
              { id: 'bl_2', name: 'Lever Type 2', price: 100 },
              { id: 'bl_3', name: 'Lever Type 3', price: 100 },
              { id: 'bl_4', name: 'Lever Type 4', price: 100 }
            ]
          },
          {
            id: 'handle', name: 'Handle Stem and Handle Bar',
            options: [
              { id: 'handle_adv_1', name: 'Advanced - Option 1', price: 170 },
              { id: 'handle_adv_2', name: 'Advanced - Option 2', price: 170 },
              { id: 'handle_basic_1', name: 'Basic - Option 1', price: 120 },
              { id: 'handle_basic_2', name: 'Basic - Option 2', price: 120 }
            ]
          }
        ],
        rimSelection: {
          id: 'rim', name: 'Rim Selection',
          options: [
            { id: 'rim_sws_b1', name: 'Single Wall Steel - Black 1', price: 700 },
            { id: 'rim_sws_b2', name: 'Single Wall Steel - Black 2', price: 720 },
            { id: 'rim_sws_s1', name: 'Single Wall Steel - Silver 1', price: 700 },
            { id: 'rim_sws_s2', name: 'Single Wall Steel - Silver 2', price: 720 },
            { id: 'rim_swa_b1', name: 'Single Wall Aluminium - Black 1', price: 900 },
            { id: 'rim_swa_b2', name: 'Single Wall Aluminium - Black 2', price: 930 },
            { id: 'rim_swa_s1', name: 'Single Wall Aluminium - Silver 1', price: 900 },
            { id: 'rim_swa_s2', name: 'Single Wall Aluminium - Silver 2', price: 930 },
            { id: 'rim_dwa_1', name: 'Double Wall Aluminium 1', price: 1200 },
            { id: 'rim_dwa_2', name: 'Double Wall Aluminium 2', price: 1250 },
            { id: 'rim_dwa_3', name: 'Double Wall Aluminium 3', price: 1300 },
            { id: 'rim_dwa_4', name: 'Double Wall Aluminium 4', price: 1350 }
          ]
        },
        cotterless: {
          id: 'cotterless', name: 'Cotterless',
          yes: {
            bbAxial: {
              id: 'bbAxialCotterless', name: 'BB Axial (Cotterless)',
              options: [
                { id: 'cl_bb_cart_1', name: 'BB Cartridge Cotterless 1', price: 600 },
                { id: 'cl_bb_cart_2', name: 'BB Cartridge Cotterless 2', price: 620 },
                { id: 'cl_bb_cart_3', name: 'BB Cartridge Cotterless 3', price: 640 },
                { id: 'cl_bb_cart_4', name: 'BB Cartridge Cotterless 4', price: 660 },
                { id: 'cl_bb_axial_1', name: 'BB Axial Only & Cup 1', price: 400 },
                { id: 'cl_bb_axial_2', name: 'BB Axial Only & Cup 2', price: 420 },
                { id: 'cl_bb_axial_3', name: 'BB Axial Only & Cup 3', price: 440 },
                { id: 'cl_bb_axial_4', name: 'BB Axial Only & Cup 4', price: 460 },
              ]
            },
            crank: {
              id: 'crankCotterless', name: 'Crank Cotterless 44T',
              options: [
                { id: 'cl_crank_1', name: 'Crank Cotterless 1', price: 700 },
                { id: 'cl_crank_2', name: 'Crank Cotterless 2', price: 730 },
                { id: 'cl_crank_3', name: 'Crank Cotterless 3', price: 760 },
                { id: 'cl_crank_4', name: 'Crank Cotterless 4', price: 790 },
              ]
            }
          },
          no: {
            bbAxial: {
              id: 'bbAxialCottered', name: 'BB Axial (Cottered)',
              options: [
                { id: 'c_bb_cart_1', name: 'BB Cartridge Cottered 1', price: 500 },
                { id: 'c_bb_cart_2', name: 'BB Cartridge Cottered 2', price: 520 },
                { id: 'c_bb_cart_3', name: 'BB Cartridge Cottered 3', price: 540 },
                { id: 'c_bb_cart_4', name: 'BB Cartridge Cottered 4', price: 560 },
                { id: 'c_bb_axial_1', name: 'BB Axial Only & Cup 1', price: 300 },
                { id: 'c_bb_axial_2', name: 'BB Axial Only & Cup 2', price: 320 },
                { id: 'c_bb_axial_3', name: 'BB Axial Only & Cup 3', price: 340 },
                { id: 'c_bb_axial_4', name: 'BB Axial Only & Cup 4', price: 360 },
              ]
            },
            crank: {
              id: 'crankCottered', name: 'Crank Cottered',
              options: [
                { id: 'c_crank_1', name: 'Crank Cottered 1', price: 400 },
                { id: 'c_crank_2', name: 'Crank Cottered 2', price: 420 },
                { id: 'c_crank_3', name: 'Crank Cottered 3', price: 440 },
                { id: 'c_crank_4', name: 'Crank Cottered 4', price: 460 },
              ]
            }
          }
        }
      };
      
      // --- NEW HELPER MAPS ---
      // These maps make it *much* easier to calculate totals and show summaries
      // We build them once from the data above.
      
      const { signaturePriceMap, signatureNameMap, signatureModelTotalParts } = (() => {
        const priceMap = {};
        const nameMap = {};
        let totalParts = 0;
        
        const data = signatureModelData;

        // 1. Compulsory
        data.compulsory.forEach(part => {
          priceMap[part.id] = part.price;
          nameMap[part.id] = part.name;
        });
        totalParts += data.compulsory.length; // These are counted
        
        // 2. Toggles
        data.toggles.forEach(part => {
          priceMap[part.id] = part.price;
          nameMap[part.id] = part.name;
        });
        totalParts += data.toggles.length; // Each toggle is a "part" to select
        
        // 3. Single Select
        data.singleSelect.forEach(group => {
          nameMap[group.id] = group.name; // e.g., 'tyre': 'Tyre - (...)'
          group.options.forEach(opt => {
            priceMap[opt.id] = opt.price;
            nameMap[opt.id] = opt.name;
          });
        });
        totalParts += data.singleSelect.length; // Each group is one part to select
        
        // 4. Rim Selection
        nameMap[data.rimSelection.id] = data.rimSelection.name;
        data.rimSelection.options.forEach(opt => {
          priceMap[opt.id] = opt.price;
          nameMap[opt.id] = opt.name;
        });
        totalParts += 1; // Rim group
        
        // 5. Cotterless
        nameMap[data.cotterless.id] = data.cotterless.name;
        totalParts += 1; // The yes/no choice
        
        // Yes choices
        nameMap[data.cotterless.yes.bbAxial.id] = data.cotterless.yes.bbAxial.name;
        data.cotterless.yes.bbAxial.options.forEach(opt => {
          priceMap[opt.id] = opt.price;
          nameMap[opt.id] = opt.name;
        });
        nameMap[data.cotterless.yes.crank.id] = data.cotterless.yes.crank.name;
        data.cotterless.yes.crank.options.forEach(opt => {
          priceMap[opt.id] = opt.price;
          nameMap[opt.id] = opt.name;
        });
        totalParts += 2; // The 2 sub-choices for 'yes'
        
        // No choices
        nameMap[data.cotterless.no.bbAxial.id] = data.cotterless.no.bbAxial.name;
        data.cotterless.no.bbAxial.options.forEach(opt => {
          priceMap[opt.id] = opt.price;
          nameMap[opt.id] = opt.name; // <--- FIX WAS HERE
        });
        nameMap[data.cotterless.no.crank.id] = data.cotterless.no.crank.name;
        data.cotterless.no.crank.options.forEach(opt => {
          priceMap[opt.id] = opt.price;
          nameMap[opt.id] = opt.name; 
        });
        totalParts += 2; // The 2 sub-choices for 'no'

        return { signaturePriceMap: priceMap, signatureNameMap: nameMap, signatureModelTotalParts: totalParts };
      })();
      
      // --- SVG ICONS ---
      const IconSun = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      );

      const IconMoon = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      );

      const IconRotateCcw = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M3 2v6h6"></path>
          <path d="M3.51 15a9 9 0 1 0 2.13-9.36L3 12"></path>
        </svg>
      );

      const IconList = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <line x1="8" y1="6" x2="21" y2="6"></line>
          <line x1="8" y1="12" x2="21" y2="12"></line>
          <line x1="8" y1="18" x2="21" y2="18"></line>
          <line x1="3" y1="6" x2="3.01" y2="6"></line>
          <line x1="3" y1="12" x2="3.01" y2="12"></line>
          <line x1="3" y1="18" x2="3.01" y2="18"></line>
        </svg>
      );

      const IconDownload = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
      );

      const IconX = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      );

      const IconCheck = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      );

      const IconArrowLeft = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
      );

      const IconWhatsApp = ({ className }) => (
        <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none">
          <path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91C2.13 13.66 2.59 15.36 3.45 16.86L2.06 21.94L7.3 20.58C8.77 21.39 10.37 21.82 12.04 21.82C17.5 21.82 21.95 17.37 21.95 11.91C21.95 6.45 17.5 2 12.04 2ZM17.95 16.39C17.66 17.21 16.64 17.8 15.77 17.95C15.06 18.07 14.15 17.91 13.39 17.65C12.19 17.28 10.45 16.59 8.78 15.02C6.82 13.18 5.48 10.98 5.2 10.6C4.92 10.22 3.99 8.91 3.99 7.71C3.99 6.51 4.7 5.8 4.98 5.52C5.26 5.24 5.67 5.18 6.09 5.18C6.23 5.18 6.36 5.18 6.49 5.19C6.83 5.21 7.11 5.22 7.35 5.74C7.62 6.31 8.28 7.9 8.38 8.09C8.47 8.28 8.57 8.5 8.42 8.74C8.28 8.98 8.18 9.08 7.99 9.27C7.8 9.46 7.64 9.6 7.48 9.77C7.31 9.93 7.15 10.1 7.34 10.4C7.53 10.7 8.18 11.75 9.18 12.69C10.41 13.85 11.37 14.23 11.72 14.38C12.07 14.53 12.31 14.5 12.5 14.33C12.74 14.12 13.13 13.62 13.43 13.25C13.61 13.01 13.9 12.92 14.19 13.01C14.48 13.11 15.93 13.82 16.27 13.98C16.61 14.14 16.83 14.23 16.92 14.32C17.02 14.41 17.02 14.8 16.92 15.19C16.83 15.58 16.68 15.97 16.54 16.16C17.25 15.61 17.66 16.03 17.95 16.39Z"></path>
        </svg>
      );

      // --- COMPONENTS ---

      /**
       * ThemeToggle Component
       */
      const ThemeToggle = ({ theme, setTheme }) => {
        const toggleTheme = () => {
          setTheme(theme === 'light' ? 'dark' : 'light');
        };

        return (
          <button
            onClick={toggleTheme}
            className="p-2 rounded-full text-gray-800 dark:text-gray-200 bg-gray-200/50 dark:bg-gray-800/50 backdrop-blur-sm hover:bg-gray-300/70 dark:hover:bg-gray-700/70 transition-colors"
            aria-label="Toggle theme"
          >
            {theme === 'light' ? <IconMoon className="w-5 h-5" /> : <IconSun className="w-5 h-5" />}
          </button>
        );
      };

      /**
       * HomePage Component
       */
      const HomePage = ({ onStart }) => {
        return (
          <div className="min-h-screen flex items-center justify-center p-4">
            <div className="text-center">
              {/* --- NAME CHANGE --- */}
              <h1 className="text-6xl md:text-8xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 dark:from-cyan-300 dark:via-blue-400 dark:to-purple-500 pb-2">
                TekVelo
              </h1>
              <p className="mt-4 text-xl md:text-2xl text-gray-700 dark:text-gray-300 max-w-2xl mx-auto">
                Craft your dream bike. Select every part, from frame to reflector, and see your custom build come to life.
              </p>
              <button
                onClick={onStart}
                className="mt-12 px-10 py-4 text-lg font-semibold text-white bg-gradient-to-r from-blue-500 to-purple-600 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 ease-in-out focus:outline-none focus:ring-4 focus:ring-blue-300 dark:focus:ring-blue-800"
              >
                Start Customizing
              </button>
            </div>
          </div>
        );
      };

      /**
       * VendorCard Component (For old models)
       */
      const VendorCard = ({ option, isSelected, onSelect }) => {
        return (
          <button
            onClick={() => onSelect(option)}
            className={`relative w-full p-4 rounded-lg shadow-md transition-all duration-300 ease-in-out border
                        ${isSelected
                          ? 'border-blue-500 dark:border-blue-400 ring-2 ring-blue-500/50 dark:ring-blue-400/50 scale-105 shadow-xl'
                          : 'border-white/20 dark:border-gray-700/50 hover:shadow-lg hover:border-blue-400/50 dark:hover:border-blue-500/50'
                        }
                        bg-white/50 dark:bg-gray-800/50 backdrop-blur-md`}
          >
            {isSelected && (
              <div className="absolute -top-3 -right-3 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-white border-2 border-white dark:border-gray-900">
                <IconCheck className="w-4 h-4" />
              </div>
            )}
            <div className="flex items-center space-x-4">
              <img src={option.image} alt={option.vendor} className="w-16 h-16 rounded-md bg-gray-200 dark:bg-gray-700 object-cover" />
              <div className="text-left">
                <h4 className="font-semibold text-gray-900 dark:text-white">{option.vendor}</h4>
                <p className="text-sm text-gray-600 dark:text-gray-400">{option.quality}</p>
                <p className="text-lg font-bold text-blue-600 dark:text-blue-400 mt-1">₹{option.price}</p>
              </div>
            </div>
          </button>
        );
      };

      /**
       * PartSelector Component (For old models)
       */
      const PartSelector = ({ partName, options, selectedOption, onSelectPart }) => {
        return (
          <div className="p-6 rounded-xl shadow-lg bg-white/30 dark:bg-gray-900/30 backdrop-blur-lg border border-white/20 dark:border-gray-700/30">
            <h3 className="text-2xl font-semibold mb-5 text-gray-900 dark:text-white">{partName}</h3>
            <div className="grid grid-cols-2 gap-4">
              {options && options.map((option, index) => (
                <VendorCard
                  key={index}
                  option={option}
                  isSelected={selectedOption?.vendor === option.vendor && selectedOption?.price === option.price}
                  onSelect={() => onSelectPart(partName, option)}
                />
              ))}
            </div>
          </div>
        );
      };

      /**
       * SummaryCard Component
       */
      const SummaryCard = ({ selections, total, onReset, onOpenModal, partsList, totalParts, partsSelected }) => {
        const progress = totalParts > 0 ? (partsSelected / totalParts) * 100 : 0;

        return (
          <div className="sticky top-6 p-6 rounded-xl shadow-xl bg-white/50 dark:bg-gray-800/50 backdrop-blur-lg border border-white/20 dark:border-gray-700/50">
            <h3 className="text-2xl font-bold text-gray-900 dark:text-white mb-4">Your Custom Build</h3>
            
            {/* Progress Bar */}
            <div>
              <div className="flex justify-between text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                <span>Progress</span>
                <span>{partsSelected} / {totalParts} parts</span>
              </div>
              <div className="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                <div 
                  className="bg-gradient-to-r from-blue-500 to-purple-600 h-2.5 rounded-full transition-all duration-500 ease-out" 
                  style={{ width: `${progress}%` }}
                ></div>
              </div>
            </div>

            <div className="my-6 border-t border-gray-300 dark:border-gray-700/50"></div>

            {/* Total Price */}
            <div className="flex justify-between items-center mb-6">
              <span className="text-xl text-gray-700 dark:text-gray-300">Total Price:</span>
              <span className="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-700 dark:from-blue-400 dark:to-purple-500">
                ₹{total}
              </span>
            </div>

            {/* Action Buttons */}
            <div className="flex flex-col space-y-3">
              <button
                onClick={onOpenModal}
                disabled={total === 0}
                className="flex items-center justify-center w-full px-6 py-3 text-base font-medium text-white bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-300 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <IconList className="w-5 h-5 mr-2" />
                View Summary
              </button>
              <button
                onClick={onReset}
                disabled={total === 0}
                className="flex items-center justify-center w-full px-6 py-3 text-base font-medium text-gray-700 dark:text-gray-300 bg-gray-200/70 dark:bg-gray-700/70 rounded-lg shadow-sm hover:bg-gray-300/90 dark:hover:bg-gray-600/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <IconRotateCcw className="w-5 h-5 mr-2" />
                Reset Build
              </button>
            </div>
          </div>
        );
      };

      /**
       * SummaryModal Component
       */
      const SummaryModal = ({ isOpen, onClose, selections, total, modelName }) => {
        if (!isOpen) return null;

        const handlePrint = () => {
          const modalNode = document.getElementById('summary-modal-container');
          if (modalNode) {
            document.body.classList.add('print-modal-container');
            window.print();
            document.body.classList.remove('print-modal-container');
          }
        };

        const handleWhatsAppShare = () => {
          const phone = '918078308961'; // Your WhatsApp number
          
          let message = `Hi TekVelo! I've built a custom bike:\n\n`;
          message += `*Model:* ${modelName}\n\n`;
          message += `*My Selections:*\n`;

          // --- DYNAMIC SUMMARY LOGIC ---
          if (modelName === 'Signature 26" steel basic"') {
            // --- NEW LOGIC ---
            // 1. Compulsory
            message += `- ${signatureNameMap['frame']} (₹${signaturePriceMap['frame']})\n`;
            message += `- ${signatureNameMap['fork']} (₹${signaturePriceMap['fork']})\n`;
            
            // 2. Toggles
            signatureModelData.toggles.forEach(toggle => {
              const selected = selections[toggle.id];
              message += `- ${toggle.name}: ${selected ? `Yes (₹${toggle.price})` : 'No'}\n`;
            });
            
            // 3. Single Select & Rim
            const allDropdowns = [
              ...signatureModelData.singleSelect,
              signatureModelData.rimSelection
            ];
            
            allDropdowns.forEach(group => {
              const selectedId = selections[group.id];
              if (selectedId) {
                message += `- ${signatureNameMap[group.id]}: ${signatureNameMap[selectedId]} (₹${signaturePriceMap[selectedId]})\n`;
              } else {
                message += `- ${signatureNameMap[group.id]}: Not selected\n`;
              }
            });
            
            // 4. Cotterless
            const cotterlessChoice = selections.cotterless;
            message += `- ${signatureNameMap.cotterless}: ${cotterlessChoice ? cotterlessChoice : 'Not selected'}\n`;
            
            if (cotterlessChoice === 'yes') {
              const bbAxialId = selections.bbAxialCotterless;
              const crankId = selections.crankCotterless;
              message += `  - ${signatureNameMap.bbAxialCotterless}: ${bbAxialId ? `${signatureNameMap[bbAxialId]} (₹${signaturePriceMap[bbAxialId]})` : 'Not selected'}\n`;
              message += `  - ${signatureNameMap.crankCotterless}: ${crankId ? `${signatureNameMap[crankId]} (₹${signaturePriceMap[crankId]})` : 'Not selected'}\n`;
            } else if (cotterlessChoice === 'no') {
              const bbAxialId = selections.bbAxialCottered;
              const crankId = selections.crankCottered;
              message += `  - ${signatureNameMap.bbAxialCottered}: ${bbAxialId ? `${signatureNameMap[bbAxialId]} (₹${signaturePriceMap[bbAxialId]})` : 'Not selected'}\n`;
              message += `  - ${signatureNameMap.crankCottered}: ${crankId ? `${signatureNameMap[crankId]} (₹${signaturePriceMap[crankId]})` : 'Not selected'}\n`;
            }

          } else {
            // --- OLD LOGIC ---
            Object.entries(selections).forEach(([part, option]) => {
              message += `- ${part}: ${option.vendor} (${option.quality}) - ₹${option.price}\n`;
            });
          }
          // --- END DYNAMIC SUMMARY LOGIC ---

          message += `\n*Total Price: ₹${total}*\n\n`;
          message += `Please let me know the next steps!`;

          const encodedMessage = encodeURIComponent(message);
          const whatsappURL = `https://wa.me/${phone}?text=${encodedMessage}`;
          window.open(whatsappURL, '_blank');
        };
        
        // Helper to render the summary list items
        const renderSummaryItems = () => {
          if (modelName === 'Signature 26" steel basic"') {
            const items = [];
            // 1. Compulsory
            items.push(
              <li key="frame" className="flex justify-between items-center py-3">
                <p className="font-medium text-gray-900 dark:text-white">{signatureNameMap['frame']}</p>
                <p className="font-semibold text-gray-800 dark:text-gray-200">₹{signaturePriceMap['frame']}</p>
              </li>,
              <li key="fork" className="flex justify-between items-center py-3">
                <p className="font-medium text-gray-900 dark:text-white">{signatureNameMap['fork']}</p>
                <p className="font-semibold text-gray-800 dark:text-gray-200">₹{signaturePriceMap['fork']}</p>
              </li>
            );
            
            // 2. Toggles
            signatureModelData.toggles.forEach(toggle => {
              const selected = selections[toggle.id];
              items.push(
                <li key={toggle.id} className="flex justify-between items-center py-3">
                  <p className="font-medium text-gray-900 dark:text-white">{toggle.name}</p>
                  <p className="font-semibold text-gray-800 dark:text-gray-200">{selected ? `Yes (₹${toggle.price})` : 'No'}</p>
                </li>
              );
            });
            
            // 3. Single Select & Rim
            const allDropdowns = [...signatureModelData.singleSelect, signatureModelData.rimSelection];
            allDropdowns.forEach(group => {
              const selectedId = selections[group.id];
              items.push(
                <li key={group.id} className="flex justify-between items-center py-3">
                  <div>
                    <p className="font-medium text-gray-900 dark:text-white">{signatureNameMap[group.id]}</p>
                    {selectedId && <p className="text-sm text-gray-600 dark:text-gray-400">{signatureNameMap[selectedId]}</p>}
                  </div>
                  <p className="font-semibold text-gray-800 dark:text-gray-200">{selectedId ? `₹${signaturePriceMap[selectedId]}` : 'N/A'}</p>
                </li>
              );
            });
            
            // 4. Cotterless
            const cotterlessChoice = selections.cotterless;
            items.push(
              <li key="cotterless" className="flex justify-between items-center py-3">
                <p className="font-medium text-gray-900 dark:text-white">{signatureNameMap.cotterless}</p>
                <p className="font-semibold text-gray-800 dark:text-gray-200">{cotterlessChoice ? cotterlessChoice : 'N/A'}</p>
              </li>
            );
            
            if (cotterlessChoice === 'yes') {
              const bbId = selections.bbAxialCotterless;
              const crankId = selections.crankCotterless;
              items.push(
                <li key="bbAxialCotterless" className="flex justify-between items-center py-3 pl-4">
                  <div>
                    <p className="font-medium text-gray-900 dark:text-white">{signatureNameMap.bbAxialCotterless}</p>
                    {bbId && <p className="text-sm text-gray-600 dark:text-gray-400">{signatureNameMap[bbId]}</p>}
                  </div>
                  <p className="font-semibold text-gray-800 dark:text-gray-200">{bbId ? `₹${signaturePriceMap[bbId]}` : 'N/A'}</p>
                </li>,
                <li key="crankCotterless" className="flex justify-between items-center py-3 pl-4">
                  <div>
                    <p className="font-medium text-gray-900 dark:text-white">{signatureNameMap.crankCotterless}</p>
                    {crankId && <p className="text-sm text-gray-600 dark:text-gray-400">{signatureNameMap[crankId]}</p>}
                  </div>
                  <p className="font-semibold text-gray-800 dark:text-gray-200">{crankId ? `₹${signaturePriceMap[crankId]}` : 'N/A'}</p>
                </li>
              );
            } else if (cotterlessChoice === 'no') {
              const bbId = selections.bbAxialCottered;
              const crankId = selections.crankCottered;
              items.push(
                <li key="bbAxialCottered" className="flex justify-between items-center py-3 pl-4">
                  <div>
                    <p className="font-medium text-gray-900 dark:text-white">{signatureNameMap.bbAxialCottered}</p>
                    {bbId && <p className="text-sm text-gray-600 dark:text-gray-400">{signatureNameMap[bbId]}</p>}
                  </div>
                  <p className="font-semibold text-gray-800 dark:text-gray-200">{bbId ? `₹${signaturePriceMap[bbId]}` : 'N/A'}</p>
                </li>,
                <li key="crankCottered" className="flex justify-between items-center py-3 pl-4">
                  <div>
                    <p className="font-medium text-gray-900 dark:text-white">{signatureNameMap.crankCottered}</p>
                    {crankId && <p className="text-sm text-gray-600 dark:text-gray-400">{signatureNameMap[crankId]}</p>}
                  </div>
                  <p className="font-semibold text-gray-800 dark:text-gray-200">{crankId ? `₹${signaturePriceMap[crankId]}` : 'N/A'}</p>
                </li>
              );
            }
            return items;
          } else {
            // --- OLD LOGIC ---
            return Object.entries(selections).map(([part, option]) => (
              <li key={part} className="flex justify-between items-center py-3">
                <div>
                  <p className="font-medium text-gray-900 dark:text-white">{part}</p>
                  <p className="text-sm text-gray-600 dark:text-gray-400">{option.vendor} ({option.quality})</p>
                </div>
                <p className="font-semibold text-gray-800 dark:text-gray-200">₹{option.price}</p>
              </li>
            ));
          }
        };

        return (
          <div 
            id="summary-modal-container"
            className="fixed inset-0 bg-black/60 dark:bg-black/70 backdrop-blur-sm z-40 flex items-center justify-center p-4 print:hidden"
            onClick={onClose}
          >
            <div 
              className="relative w-full max-w-2xl max-h-[90vh] bg-white dark:bg-gray-800 rounded-2xl shadow-2xl flex flex-col overflow-hidden"
              onClick={e => e.stopPropagation()}
            >
              {/* Modal Header */}
              <div className="flex items-start justify-between p-6 border-b border-gray-200 dark:border-gray-700 print:hidden">
                <h3 className="text-2xl font-bold text-gray-900 dark:text-white">
                  Your Custom Build Summary
                </h3>
                <button 
                  onClick={onClose} 
                  className="p-1 rounded-full text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 hover:text-gray-600 dark:hover:text-gray-200 transition-colors"
                >
                  <IconX className="w-6 h-6" />
                </button>
              </div>

              {/* Modal Body */}
              <div className="p-6 space-y-4 overflow-y-auto" id="summary-to-print">
                <div className="text-center print:text-left">
                  <h4 className="text-lg font-semibold text-gray-800 dark:text-gray-200">Model: {modelName}</h4>
                  <p className="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-700 dark:from-blue-400 dark:to-purple-500 mt-1">
                    Total: ₹{total}
                  </p>
                </div>
                
                <div className="my-4 border-t border-gray-200 dark:border-gray-700"></div>

                <h5 className="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-2">Selected Parts:</h5>
                <ul className="divide-y divide-gray-200 dark:divide-gray-700">
                  {renderSummaryItems()}
                </ul>
              </div>

              {/* Modal Footer */}
              <div className="flex flex-col sm:flex-row items-center justify-end p-6 border-t border-gray-200 dark:border-gray-700 print:hidden space-y-3 sm:space-y-0 sm:space-x-3">
                <button
                  onClick={onClose}
                  className="w-full sm:w-auto px-6 py-2 text-base font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                >
                  Close
                </button>
                <button
                  onClick={handleWhatsAppShare}
                  className="flex items-center justify-center w-full sm:w-auto px-6 py-2 text-base font-medium text-white bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-300"
                >
                  <IconWhatsApp className="w-5 h-5 mr-2" />
                  Send to WhatsApp
                </button>
                <button
                  onClick={handlePrint}
                  className="flex items-center justify-center w-full sm:w-auto px-6 py-2 text-base font-medium text-white bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-300"
                >
                  <IconDownload className="w-5 h-5 mr-2" />
                  Download as PDF
                </button>
              </div>
            </div>
          </div>
        );
      };

      {/* --- MOVED ALL NEW COMPONENT DEFINITIONS *BEFORE* BUILDERPAGE --- */}
      
      /**
       * --- NEW COMPONENT for "Signature 26" steel basic" ---
       */
       
      // A simple Yes/No toggle
      const YesNoToggle = ({ part, isSelected, onToggle }) => {
        return (
          <div className="flex items-center justify-between p-4 bg-white/50 dark:bg-gray-800/50 rounded-lg shadow-sm h-full">
            <div>
              <p className="font-semibold text-gray-900 dark:text-white">{part.name}</p>
              <p className="text-sm text-gray-600 dark:text-gray-400">Price: ₹{part.price}</p>
            </div>
            <div className="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in flex-shrink-0">
              <input 
                type="checkbox" 
                name={part.id}
                id={part.id}
                checked={isSelected}
                onChange={() => onToggle(part.id, !isSelected)}
                className="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white dark:bg-gray-600 border-2 border-gray-300 dark:border-gray-500 appearance-none cursor-pointer transition-transform duration-200 ease-in-out"
              />
              <label 
                htmlFor={part.id}
                className="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 dark:bg-gray-500 cursor-pointer"
              ></label>
            </div>
          </div>
        );
      };
      
      // A simple dropdown for single-select groups
      const SingleSelectDropdown = ({ group, selectedValue, onSelect }) => {
        return (
          <div className="space-y-2">
            <label htmlFor={group.id} className="block text-lg font-semibold text-gray-900 dark:text-white">
              {group.name}
            </label>
            <select
              id={group.id}
              value={selectedValue || ""}
              onChange={(e) => onSelect(group.id, e.target.value)}
              className="w-full p-3 text-lg bg-white/50 dark:bg-gray-800/50 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"
            >
              <option value="" disabled>Select {group.name}...</option>
              {group.options.map(opt => (
                <option key={opt.id} value={opt.id}>
                  {opt.name} (₹{opt.price})
                </option>
              ))}
            </select>
          </div>
        );
      };

      const SignatureModelBuilder = ({ data, selections, setSelections }) => {
        
        const handleToggle = (partId, isSelected) => {
          setSelections(prev => ({
            ...prev,
            [partId]: isSelected
          }));
        };
        
        const handleSelect = (groupId, optionId) => {
          setSelections(prev => ({
            ...prev,
            [groupId]: optionId
          }));
        };
        
        const handleCotterlessChange = (choice) => {
          setSelections(prev => {
            const newSelections = {...prev, cotterless: choice};
            // Clear the sub-selections when changing
            if (choice === 'yes') {
              delete newSelections.bbAxialCottered;
              delete newSelections.crankCottered;
            } else {
              delete newSelections.bbAxialCotterless;
              delete newSelections.crankCotterless;
            }
            return newSelections;
          });
        };

        return (
          <div className="space-y-8">
            <h2 className="text-3xl font-bold text-gray-900 dark:text-white">
              2. Customize Your Parts
            </h2>
            
            {/* --- Compulsory Parts --- */}
            <div className="p-6 rounded-xl shadow-lg bg-white/30 dark:bg-gray-900/30 backdrop-blur-lg border border-white/20 dark:border-gray-700/30">
              <h3 className="text-2xl font-semibold mb-4 text-gray-900 dark:text-white">Compulsory Parts</h3>
              {/* --- UPDATED TO GRID --- */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {data.compulsory.map(part => (
                  <div key={part.id} className="flex items-center justify-between p-4 bg-white/50 dark:bg-gray-800/50 rounded-lg shadow-sm h-full">
                    <p className="font-semibold text-gray-900 dark:text-white">{part.name}</p>
                    <p className="text-lg font-bold text-blue-600 dark:text-blue-400 flex-shrink-0 ml-4">₹{part.price}</p>
                  </div>
                ))}
              </div>
            </div>
            
            {/* --- Toggle (Yes/No) Parts --- */}
            <div className="p-6 rounded-xl shadow-lg bg-white/30 dark:bg-gray-900/30 backdrop-blur-lg border border-white/20 dark:border-gray-700/30">
              <h3 className="text-2xl font-semibold mb-4 text-gray-900 dark:text-white">Optional Parts (Yes/No)</h3>
              {/* --- UPDATED TO GRID --- */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {data.toggles.map(part => (
                  <YesNoToggle 
                    key={part.id}
                    part={part}
                    isSelected={!!selections[part.id]}
                    onToggle={handleToggle}
                  />
                ))}
              </div>
            </div>
            
            {/* --- Single Selection Parts --- */}
            <div className="p-6 rounded-xl shadow-lg bg-white/30 dark:bg-gray-900/30 backdrop-blur-lg border border-white/20 dark:border-gray-700/30">
              <h3 className="text-2xl font-semibold mb-4 text-gray-900 dark:text-white">Single Selections</h3>
              <div className="space-y-6">
                {data.singleSelect.map(group => (
                  <SingleSelectDropdown 
                    key={group.id}
                    group={group}
                    selectedValue={selections[group.id]}
                    onSelect={handleSelect}
                  />
                ))}
              </div>
            </div>
            
            {/* --- Rim Selection (Dual/Multiple) --- */}
            <div className="p-6 rounded-xl shadow-lg bg-white/30 dark:bg-gray-900/30 backdrop-blur-lg border border-white/20 dark:border-gray-700/30">
              <h3 className="text-2xl font-semibold mb-4 text-gray-900 dark:text-white">Rim Selection</h3>
              <div className="space-y-2">
                <label htmlFor={data.rimSelection.id} className="block text-lg font-semibold text-gray-900 dark:text-white">
                  {data.rimSelection.name}
                </label>
                <select
                  id={data.rimSelection.id}
                  value={selections[data.rimSelection.id] || ""}
                  onChange={(e) => handleSelect(data.rimSelection.id, e.target.value)}
                  className="w-full p-3 text-lg bg-white/50 dark:bg-gray-800/50 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"
                >
                  <option value="" disabled>Select Rim...</option>
                  <optgroup label="Single Wall Steel - Black">
                    <option value="rim_sws_b1">Black Option 1 (₹700)</option>
                    <option value="rim_sws_b2">Black Option 2 (₹720)</option>
                  </optgroup>
                  <optgroup label="Single Wall Steel - Silver">
                    <option value="rim_sws_s1">Silver Option 1 (₹700)</option>
                    <option value="rim_sws_s2">Silver Option 2 (₹720)</option>
                  </optgroup>
                  <optgroup label="Single Wall Aluminium - Black">
                    <option value="rim_swa_b1">Black Option 1 (₹900)</option>
                    <option value="rim_swa_b2">Black Option 2 (₹930)</option>
                  </optgroup>
                  <optgroup label="Single Wall Aluminium - Silver">
                    <option value="rim_swa_s1">Silver Option 1 (₹900)</option>
                    <option value="rim_swa_s2">Silver Option 2 (₹930)</option>
                  </optgroup>
                  <optgroup label="Double Wall Aluminium">
                    <option value="rim_dwa_1">Option 1 (₹1200)</option>
                    <option value="rim_dwa_2">Option 2 (₹1250)</option>
                    <option value="rim_dwa_3">Option 3 (₹1300)</option>
                    <option value="rim_dwa_4">Option 4 (₹1350)</option>
                  </optgroup>
                </select>
              </div>
            </div>
            
            {/* --- Cotterless Selection --- */}
            <div className="p-6 rounded-xl shadow-lg bg-white/30 dark:bg-gray-900/30 backdrop-blur-lg border border-white/20 dark:border-gray-700/30">
              <h3 className="text-2xl font-semibold mb-4 text-gray-900 dark:text-white">{data.cotterless.name}</h3>
              <div className="flex gap-4 mb-4">
                <button
                  onClick={() => handleCotterlessChange('yes')}
                  className={`w-full p-3 rounded-lg font-semibold transition-all ${
                    selections.cotterless === 'yes'
                      ? 'bg-blue-600 text-white shadow-lg scale-105'
                      : 'bg-white/70 dark:bg-gray-800/70 hover:bg-white dark:hover:bg-gray-800'
                  }`}
                >
                  Yes
                </button>
                <button
                  onClick={() => handleCotterlessChange('no')}
                  className={`w-full p-3 rounded-lg font-semibold transition-all ${
                    selections.cotterless === 'no'
                      ? 'bg-blue-600 text-white shadow-lg scale-105'
                      : 'bg-white/70 dark:bg-gray-800/70 hover:bg-white dark:hover:bg-gray-800'
                  }`}
                >
                  No
                </button>
              </div>
              
              {/* --- Conditional Fields --- */}
              {selections.cotterless === 'yes' && (
                <div className="space-y-4 pt-4 border-t border-gray-300 dark:border-gray-700">
                  <SingleSelectDropdown 
                    group={data.cotterless.yes.bbAxial} 
                    selectedValue={selections[data.cotterless.yes.bbAxial.id]} 
                    onSelect={handleSelect} 
                  />
                  <SingleSelectDropdown 
                    group={data.cotterless.yes.crank} 
                    selectedValue={selections[data.cotterless.yes.crank.id]} 
                    onSelect={handleSelect} 
                  />
                </div>
              )}
              {selections.cotterless === 'no' && (
                <div className="space-y-4 pt-4 border-t border-gray-300 dark:border-gray-700">
                  <SingleSelectDropdown 
                    group={data.cotterless.no.bbAxial} 
                    selectedValue={selections[data.cotterless.no.bbAxial.id]} 
                    onSelect={handleSelect} 
                  />
                  <SingleSelectDropdown 
                    group={data.cotterless.no.crank} 
                    selectedValue={selections[data.cotterless.no.crank.id]} 
                    onSelect={handleSelect} 
                  />
                </div>
              )}
              
            </div>
            
          </div>
        );
      }
      
      /**
       * DefaultModelBuilder Component
       * Renders the original 5-vendor-card layout
       */
      const DefaultModelBuilder = ({ parts, options, selections, onSelectPart }) => {
        return (
          <div className="space-y-8">
            <h2 className="text-3xl font-bold text-gray-900 dark:text-white">
              2. Customize Your Parts
            </h2>
            {parts.map(partName => (
              <PartSelector
                key={partName}
                partName={partName}
                options={options[partName]}
                selectedOption={selections[partName]}
                onSelectPart={onSelectPart}
              />
            ))}
          </div>
        );
      }


      /**
       * BuilderPage Component
       */
      const BuilderPage = ({ onBackHome, theme, setTheme }) => {
        const [selectedModel, setSelectedModel] = React.useState(Object.keys(partLists)[0]);
        const [selections, setSelections] = React.useState({});
        const [isModalOpen, setIsModalOpen] = React.useState(false);

        // --- OLD MODEL LOGIC ---
        const currentParts_Old = React.useMemo(() => {
          return partLists[selectedModel] || [];
        }, [selectedModel]);
        
        const currentOptions_Old = React.useMemo(() => {
          return currentParts_Old.reduce((acc, partName) => {
            acc[partName] = partDetails[partName] || [];
            return acc;
          }, {});
        }, [currentParts_Old]);
        // --- END OLD MODEL LOGIC ---

        const totalPrice = React.useMemo(() => {
          // --- CHECK MODEL ---
          if (selectedModel !== 'Signature 26" steel basic"') {
            // --- OLD LOGIC ---
            return Object.values(selections).reduce((total, option) => total + (option.price || 0), 0);
          } else {
            // --- NEW LOGIC ---
            let total = 0;
            
            // 1. Add compulsory parts
            total += signaturePriceMap['frame'];
            total += signaturePriceMap['fork'];
            
            // 2. Iterate over all selections
            for (const [key, value] of Object.entries(selections)) {
              if (key === 'cotterless') continue; // Not a part price
              
              if (value === true) {
                // It's a toggle that is ON
                total += signaturePriceMap[key] || 0; // e.g., signaturePriceMap['forkFitting']
              } else if (typeof value === 'string') {
                // It's a selected option ID from a dropdown
                total += signaturePriceMap[value] || 0; // e.g., signaturePriceMap['ralsonTyre']
              }
            }
            return total;
          }
        }, [selections, selectedModel]);
        
        // Handle changing the model
        const handleModelChange = (e) => {
          setSelectedModel(e.target.value);
          setSelections({}); // Reset selections when model changes
        };

        // --- OLD MODEL HANDLER ---
        const handleSelectPart_Old = (partName, option) => {
          setSelections(prev => ({
            ...prev,
            [partName]: option
          }));
        };
        // --- END OLD MODEL HANDLER ---

        // Handle resetting the build
        const handleReset = () => {
          setSelections({});
        };
        
        // --- DYNAMIC PARTS LIST FOR SUMMARY ---
        const currentPartsList = selectedModel === 'Signature 26" steel basic"'
          ? signatureModelData // Pass the whole structure
          : currentParts_Old; // Pass the simple array

        const totalParts = selectedModel === 'Signature 26" steel basic"'
          ? signatureModelTotalParts
          : currentParts_Old.length;
          
        const partsSelected = Object.keys(selections).filter(k => k !== 'cotterless' && selections[k]).length;
        
        return (
          <div className="min-h-screen p-4 md:p-8">
            {/* Header */}
            <header className="flex justify-between items-center mb-8">
              <button onClick={onBackHome} className="flex items-center gap-2 group">
                <IconArrowLeft className="w-6 h-6 text-blue-500 group-hover:text-purple-600 transition-colors" />
                {/* --- NAME CHANGE --- */}
                <h1 className="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-600 dark:from-cyan-300 dark:to-purple-500">
                  TekVelo
                </h1>
              </button>
              <ThemeToggle theme={theme} setTheme={setTheme} />
            </header>

            {/* Main Content Grid */}
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
              
              {/* Left Column: Selections */}
              <div className="lg:col-span-2 space-y-8">
                
                <div className="p-6 rounded-xl shadow-lg bg-white/30 dark:bg-gray-900/30 backdrop-blur-lg border border-white/20 dark:border-gray-700/30">
                  <h2 className="text-3xl font-bold text-gray-900 dark:text-white mb-4">
                    1. Select Your Model
                  </h2>
                  <select
                    value={selectedModel}
                    onChange={handleModelChange}
                    className="w-full p-3 text-lg bg-white/50 dark:bg-gray-800/50 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"
                  >
                    {Object.keys(partLists).map(modelName => (
                      <option key={modelName} value={modelName}>{modelName}</option>
                    ))}
                  </select>
                </div>

                {/* --- DYNAMIC BUILDER UI --- */}
                {selectedModel === 'Signature 26" steel basic"' ? (
                  <SignatureModelBuilder 
                    data={signatureModelData} 
                    selections={selections} 
                    setSelections={setSelections} 
                  />
                ) : (
                  <DefaultModelBuilder 
                    parts={currentParts_Old} 
                    options={currentOptions_Old} 
                    selections={selections} 
                    onSelectPart={handleSelectPart_Old} 
                  />
                )}
                {/* --- END DYNAMIC BUILDER UI --- */}
                
              </div>

              {/* Right Column: Summary (Sticky) */}
              <div className="lg:col-span-1">
                <SummaryCard
                  selections={selections}
                  total={totalPrice}
                  onReset={handleReset}
                  onOpenModal={() => setIsModalOpen(true)}
                  partsList={currentPartsList} // Pass dynamic list
                  totalParts={totalParts}
                  partsSelected={partsSelected}
                />
              </div>
            </div>

            {/* Summary Modal */}
            <SummaryModal
              isOpen={isModalOpen}
              onClose={() => setIsModalOpen(false)}
              selections={selections}
              total={totalPrice}
              modelName={selectedModel}
            />
          </div>
        );
      };

      /**
       * App Component
       */
      function App() {
        const [page, setPage] = React.useState('home');
        const [theme, setTheme] = React.useState('light');

        React.useEffect(() => {
          if (theme === 'dark') {
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.classList.remove('dark');
          }
        }, [theme]);

        const handleStart = () => {
          setPage('builder');
        };
        
        const handleBackHome = () => {
          setPage('home');
        }

        return (
          <div className={`min-h-screen bg-gradient-to-br from-gray-100 to-blue-100 dark:from-gray-900 dark:to-purple-900 text-gray-900 dark:text-gray-100 transition-colors duration-300`}>
            {page === 'home' && <HomePage onStart={handleStart} />}
            {page === 'builder' && <BuilderPage onBackHome={handleBackHome} theme={theme} setTheme={setTheme} />}
          </div>
        );
      }

      // --- END OF INLINED REACT APP ---
    </script>
    
    <!-- 6. Mount your App component to the 'root' div -->
    <script type="text/babel">
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
    
  </body>
</html>

